<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 转 转注祝 转专</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/papaparse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .upload-section {
            border: 2px dashed #3498db;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            border-radius: 10px;
            background-color: #ecf0f1;
        }
        .upload-section:hover {
            background-color: #d5dbdb;
        }
        input[type="file"] {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .results {
            margin-top: 30px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: center;
        }
        th {
            background-color: #34495e;
            color: white;
            font-weight: bold;
        }
        .top5 {
            background-color: #e8f5e8;
        }
        .rank-1 { background-color: #f1c40f; color: #2c3e50; font-weight: bold; }
        .rank-2 { background-color: #95a5a6; color: white; font-weight: bold; }
        .rank-3 { background-color: #e67e22; color: white; font-weight: bold; }
        .summary {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .criteria-legend {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>  转 转注祝 转专</h1>
        
        <div class="criteria-legend">
            <h3> 拽专专 注专:</h3>
            <ul>
                <li><strong>拽专专 1 - 砖转:</strong> 注  转 爪注 驻注</li>
                <li><strong>拽专专 2 - 专转:</strong>  住 转拽驻</li>
                <li><strong>拽专专 3 - 驻转:</strong> 专转 驻转</li>
                <li><strong>拽专专 4 - 拽 注 砖专:</strong> 转 专转 专</li>
            </ul>
        </div>

        <div class="upload-section">
            <h3> 注转 拽抓</h3>
            <p>专 转 拽抓 爪 -Google Forms (转 驻专: CSV, XLS, XLSX)</p>
            <input type="file" id="fileInput" accept=".csv,.xls,.xlsx" />
            <br>
            <button onclick="processFile()">注 拽抓</button>
        </div>
        
        <div id="results" class="results"></div>
    </div>

    <script>
        function processFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                alert(' 专 拽抓');
                return;
            }
            
            const fileName = file.name.toLowerCase();
            const fileExtension = fileName.split('.').pop();
            
            if (fileExtension === 'csv') {
                if (typeof Papa === 'undefined') {
                    alert('砖: 住驻专转 PapaParse  注.  专注 转 祝 住 砖.');
                    return;
                }
                
                Papa.parse(file, {
                    header: true,
                    skipEmptyLines: true,
                    complete: function(results) {
                        if (results.data) {
                            processData(results.data);
                        } else {
                            alert('砖 注 拽抓 CSV.');
                        }
                    },
                    error: function(error) {
                        alert('砖 拽专转 拽抓 CSV: ' + error.message);
                    }
                });
            } else if (fileExtension === 'xlsx' || fileExtension === 'xls') {
                if (typeof XLSX === 'undefined') {
                    alert('砖: 住驻专转 XLSX  注.  专注 转 祝 住 砖.');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, {type: 'array'});
                        
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        
                        const jsonData = XLSX.utils.sheet_to_json(worksheet);
                        
                        processData(jsonData);

                    } catch (error) {
                        alert('砖 拽专转 拽抓 拽住: ' + error.message);
                        console.error('Excel processing error:', error);
                    }
                };
                reader.readAsArrayBuffer(file);
            } else {
                alert('驻专 拽抓  转.  专 拽抓 CSV, XLS  XLSX');
            }
        }

        function processData(data) {
            if (!data || data.length === 0) {
                alert(" 爪 转 注 拽抓.");
                return;
            }
             
            const firstRow = data[0];
            if (!firstRow['转专 1 [拽专专 1 - 砖转]']) {
                 alert("砖:  拽抓  转 转 驻专 专砖.  砖转专转 转拽转.");
                 console.error("Missing expected headers. First row:", firstRow);
                 return;
            }
            
            const challenges = {};
            for (let i = 1; i <= 10; i++) {
                challenges[`转专 ${i}`] = {
                    implementability: [],
                    relevance: [],
                    urgency: [],
                    alignment: []
                };
            }

            data.forEach(row => {
                for (let i = 1; i <= 10; i++) {
                    const challengeKey = `转专 ${i}`;
                    
                    const impl = parseFloat(row[`转专 ${i} [拽专专 1 - 砖转]`]);
                    const rel = parseFloat(row[`转专 ${i} [拽专专 2 - 专转  住 转拽驻]`]);
                    const urg = parseFloat(row[`转专 ${i} [拽专专 3 - 驻转]`]);
                    const align = parseFloat(row[`转专 ${i} [拽专专 4 - 拽 注 砖专]`]);
                    
                    if (!isNaN(impl)) challenges[challengeKey].implementability.push(impl);
                    if (!isNaN(rel)) challenges[challengeKey].relevance.push(rel);
                    if (!isNaN(urg)) challenges[challengeKey].urgency.push(urg);
                    if (!isNaN(align)) challenges[challengeKey].alignment.push(align);
                }
            });

            const results = [];
            
            Object.keys(challenges).forEach(challenge => {
                const scores = challenges[challenge];
                
                const responseCount = scores.implementability.length;
                if (responseCount === 0) return; 

                const avgImpl = average(scores.implementability);
                const avgRel = average(scores.relevance);
                const avgUrg = average(scores.urgency);
                const avgAlign = average(scores.alignment);
                
                const overallAvg = (avgImpl + avgRel + avgUrg + avgAlign) / 4;
                
                results.push({
                    challenge: challenge,
                    implementability: avgImpl,
                    relevance: avgRel,
                    urgency: avgUrg,
                    alignment: avgAlign,
                    overall: overallAvg,
                    responseCount: responseCount
                });
            });
            
            results.sort((a, b) => b.overall - a.overall);
            
            displayResults(results, data.length);
        }

        function average(arr) {
            if (arr.length === 0) return 0;
            return arr.reduce((a, b) => a + b, 0) / arr.length;
        }

        function displayResults(results, totalResponses) {
            const resultsDiv = document.getElementById('results');
            
            if (results.length === 0) {
                resultsDiv.innerHTML = `<div class="summary"><h3> 爪 转 转拽驻 砖.</h3><p>  砖拽抓  爪 住驻专 注转 转转.</p></div>`;
                return;
            }

            const top5 = results.slice(0, 5);
            
            let html = `
                <div class="summary">
                    <h2> 住 转爪转 转注祝</h2>
                    <p><strong>住驻专  砖 砖:</strong> ${totalResponses}</p>
                    <p><strong>转专 注:</strong> ${new Date().toLocaleDateString('he-IL')}</p>
                </div>
                
                <div class="summary">
                    <h3> 砖转 转专 </h3>
                    <ol>
            `;
            
            top5.forEach(result => {
                html += `<li><strong>${result.challenge}</strong> - 爪 : ${result.overall.toFixed(2)}</li>`;
            });
            
            html += `
                    </ol>
                </div>
                
                <h3> 转 转爪转 驻专转</h3>
                <table>
                    <thead>
                        <tr>
                            <th>专</th>
                            <th>转专</th>
                            <th>砖转 (爪注)</th>
                            <th>专转 (爪注)</th>
                            <th>驻转 (爪注)</th>
                            <th>拽 (爪注)</th>
                            <th>爪  (爪注)</th>
                            <th>住驻专 砖 转专</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            results.forEach((result, index) => {
                let rowClass = '';
                if (index < 5) rowClass += ' top5';
                if (index === 0) rowClass += ' rank-1';
                if (index === 1) rowClass += ' rank-2';
                if (index === 2) rowClass += ' rank-3';
                
                html += `
                    <tr class="${rowClass.trim()}">
                        <td><strong>${index + 1}</strong></td>
                        <td><strong>${result.challenge}</strong></td>
                        <td>${result.implementability.toFixed(2)}</td>
                        <td>${result.relevance.toFixed(2)}</td>
                        <td>${result.urgency.toFixed(2)}</td>
                        <td>${result.alignment.toFixed(2)}</td>
                        <td><strong>${result.overall.toFixed(2)}</strong></td>
                        <td>${result.responseCount}</td>
                    </tr>
                `;
            });
            
            html += `
                    </tbody>
                </table>
                
                <div style="margin-top: 30px; padding: 20px; background-color: #e8f5e8; border-radius: 10px;">
                    <h3> 爪转 驻注</h3>
                    <p><strong>抓 转拽 -5 转专 :</strong></p>
                    <ul>
            `;
            
            top5.forEach((result) => {
                html += `<li>${result.challenge} (爪: ${result.overall.toFixed(2)})</li>`;
            });
            
            html += `
                    </ul>
                    <p><strong>砖拽 住驻:</strong></p>
                    <ul>
                        <li>拽 转专 注 住转 转拽  爪 (驻注专   砖转转驻).</li>
                        <li>砖拽 砖  爪注 转专 .</li>
                        <li>转注爪 注 注 注 住驻  转爪转.</li>
                    </ul>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }
    </script>
</body>
</html>