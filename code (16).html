<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ספר הזכרונות שלי</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Varela+Round&display=swap">
  <style>
    :root {
      --primary-color: #4e7dff;
      --secondary-color: #ff6b6b;
      --accent-color: #ffbe0b;
      --text-color: #333;
      --light-bg: #f8f9fa;
      --box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    body {
      font-family: 'Varela Round', 'Arial Hebrew', Arial, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      margin: 0;
      padding: 20px;
      direction: rtl;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: var(--box-shadow);
      position: relative;
      overflow: hidden;
    }
    
    h1 {
      text-align: center;
      color: var(--primary-color);
      margin-bottom: 30px;
      font-size: 2.2rem;
    }
    
    h2 {
      color: var(--secondary-color);
      border-right: 4px solid var(--accent-color);
      padding-right: 10px;
      margin-top: 30px;
    }
    
    .page {
      margin-bottom: 40px;
      padding-bottom: 20px;
      border-bottom: 2px dashed #ccc;
    }
    
    .page:last-of-type {
      border-bottom: none;
    }

    .quote {
      font-style: italic;
      text-align: center;
      margin: 30px 0;
      color: #666;
      background-color: var(--light-bg);
      padding: 15px;
      border-radius: 10px;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    
    input, textarea {
      width: 100%;
      box-sizing: border-box;
      padding: 12px 15px;
      border: 2px solid #e1e5eb;
      border-radius: 10px;
      font-size: 16px;
      font-family: 'Varela Round', 'Arial Hebrew', Arial, sans-serif;
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
        
    .buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
    }
    
    button {
      padding: 12px 25px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      font-family: 'Varela Round', 'Arial Hebrew', Arial, sans-serif;
      display: flex;
      align-items: center;
      gap: 8px;
    }
        
    button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
    }

    .creator {
      text-align: left;
      font-size: 14px;
      color: #888;
      margin-top: 20px;
      font-style: italic;
    }
    
    .page-indicator {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .print-button {
      background-color: #28a745;
    }
    
    .image-upload {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0;
    }
    
    .image-preview {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--primary-color);
      margin-bottom: 10px;
      background-color: #f0f0f0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 3rem;
      color: #aaa;
      background-size: cover;
      background-position: center;
    }
        
    .image-upload-button {
      background-color: var(--light-bg);
      color: var(--text-color);
      border: 1px solid #ddd;
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
    }
    
    /* Print Styles - חוקי ה-CSS להדפסה נשארים חשובים */
    @media print {
      body {
        background: white;
        padding: 0;
        margin: 0;
      }
      .container {
        box-shadow: none;
        border: none;
        width: 100%;
        max-width: 100%;
      }
      .no-print {
        display: none !important;
      }
      .page {
        display: block !important; /* מוודא שהעמודים גלויים להדפסה */
        page-break-after: always;
        border-bottom: none;
      }
      .page:last-child {
        page-break-after: avoid;
      }
      h1, h2 { color: #000 !important; }
      .image-preview {
        border-color: #000 !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
    }

    /* Responsive styles for Mobile */
    @media (max-width: 768px) {
        .buttons { flex-direction: column; align-items: center; gap: 15px; }
        .buttons button { width: 80%; justify-content: center; }
        .container { padding: 15px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="page-indicator no-print">עמוד <span id="current-page">1</span> מתוך <span id="total-pages">5</span></div>
    
    <!-- כל עמודי הספר כאן... -->
    <!-- עמוד 1 -->
    <div class="page" id="page1">
      <h1>ספר הזכרונות שלי <i class="fas fa-book"></i></h1>
      <div class="image-upload">
        <div id="profile-preview" class="image-preview"><i class="fas fa-user"></i></div>
        <input type="file" id="profile-upload" accept="image/*" style="display: none;">
        <button class="image-upload-button no-print" onclick="document.getElementById('profile-upload').click()">
          <i class="fas fa-camera"></i> הוסף תמונה
        </button>
      </div>
      <div class="form-group"><label for="name">שם:</label><input type="text" id="name" name="name" placeholder="הקלד את שמך כאן"></div>
      <div class="form-group"><label for="class">כיתה:</label><input type="text" id="class" name="class" placeholder="באיזו כיתה את/ה?"></div>
      <div class="form-group"><label for="school">בית ספר:</label><input type="text" id="school" name="school" placeholder="שם בית הספר שלך"></div>
      <div class="quote">"החלומות שלך לא צריכים להיות גדולים, הם צריכים להיות שלך" (גרי וי)</div>
      <div class="creator">יצרה: יעל שטיינברג</div>
    </div>

    <!-- עמוד 2 -->
    <div class="page" id="page2" style="display: none;">
      <h1>זיכרונות מהשנה <i class="fas fa-heart"></i></h1>
      <div class="form-group"><label for="funny-story">מקרה מצחיק שקרה לי</label><textarea id="funny-story" name="funny-story" placeholder="ספר/י על מקרה מצחיק..."></textarea></div>
      <div class="form-group"><label for="new-thing">דבר חדש שלמדתי</label><textarea id="new-thing" name="new-thing" placeholder="משהו חדש שלמדת..."></textarea></div>
      <div class="form-group"><label for="achievement">הישג שאני גאה בו</label><textarea id="achievement" name="achievement" placeholder="משהו שהתאמצת והצלחת בו..."></textarea></div>
      <div class="creator">יצרה: יעל שטיינברג</div>
    </div>

    <!-- עמוד 3 -->
    <div class="page" id="page3" style="display: none;">
      <h1>החברים שלי <i class="fas fa-users"></i></h1>
      <div class="form-group"><label for="best-friends">החבר/ה הכי טוב/ים שלי הם:</label><textarea id="best-friends" name="best-friends" placeholder="כתבו כאן את שמות החברים..."></textarea></div>
      <div class="form-group"><label for="friend-activities">מה הכי אהבנו לעשות יחד?</label><textarea id="friend-activities" name="friend-activities" placeholder="לשחק, לדבר, ליצור..."></textarea></div>
      <div class="image-upload">
        <div id="friends-preview" class="image-preview"><i class="fas fa-users"></i></div>
        <input type="file" id="friends-upload" accept="image/*" style="display: none;">
        <button class="image-upload-button no-print" onclick="document.getElementById('friends-upload').click()">
          <i class="fas fa-camera"></i> הוסף תמונה של החברים
        </button>
      </div>
      <div class="creator">יצרה: יעל שטיינברג</div>
    </div>

    <!-- עמוד 4 -->
    <div class="page" id="page4" style="display: none;">
      <h1>תודות ואיחולים <i class="fas fa-gift"></i></h1>
      <div class="form-group"><label for="thanks-to">אני רוצה להגיד תודה ל...</label><textarea id="thanks-to" name="thanks-to" placeholder="למורה, לחבר/ה, להורים..."></textarea></div>
      <div class="form-group"><label for="about-me">משהו שהייתי רוצה שידעו עליי</label><textarea id="about-me" name="about-me" placeholder="תחביב מיוחד, חלום..."></textarea></div>
      <div class="form-group"><label for="friends-messages">מסר מהחברים</label><textarea id="friends-messages" name="friends-messages" placeholder="בקשו מהחברים לכתוב כאן..."></textarea></div>
      <div class="creator">יצרה: יעל שטיינברג</div>
    </div>
    
    <!-- עמוד 5 -->
    <div class="page" id="page5" style="display: none;">
      <h1>חופשה נעימה! <i class="fas fa-sun"></i></h1>
      <div class="form-group"><label for="vacation-plans">התכניות שלי לחופש הגדול</label><textarea id="vacation-plans" name="vacation-plans" placeholder="לנסוע לים, לבקר חברים..."></textarea></div>
      <div class="image-upload">
        <div id="class-preview" class="image-preview" style="border-radius: 10px; width: 80%; height: 200px;"><i class="fas fa-school"></i></div>
        <input type="file" id="class-upload" accept="image/*" style="display: none;">
        <button class="image-upload-button no-print" onclick="document.getElementById('class-upload').click()">
          <i class="fas fa-camera-retro"></i> הוסף תמונה כיתתית
        </button>
      </div>
      <div class="quote">"נתראה בשנה הבאה עם חוויות חדשות!"</div>
      <div class="creator">יצרה: יעל שטיינברג</div>
    </div>

    <!-- כפתורי ניווט ובקרה -->
    <div class="buttons no-print">
      <button id="prev-btn"><i class="fas fa-arrow-right"></i> הקודם</button>
      <button id="print-btn" class="print-button"><i class="fas fa-print"></i> הדפס / שמור כ-PDF</button>
      <button id="next-btn">הבא <i class="fas fa-arrow-left"></i></button>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const pages = document.querySelectorAll('.page');
      const totalPages = pages.length;
      let currentPage = 1;

      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');
      const printBtn = document.getElementById('print-btn');
      const currentPageSpan = document.getElementById('current-page');
      const totalPagesSpan = document.getElementById('total-pages');

      // שמירה וטעינה מ-localStorage
      const formElements = document.querySelectorAll('input, textarea');
      formElements.forEach(el => {
        const savedValue = localStorage.getItem(el.id);
        if (savedValue) { el.value = savedValue; }
        el.addEventListener('input', () => localStorage.setItem(el.id, el.value));
      });

      // פונקציות ניווט
      function showPage(pageNumber) {
        pages.forEach(page => page.style.display = 'none');
        document.getElementById(`page${pageNumber}`).style.display = 'block';
        currentPageSpan.textContent = pageNumber;
        updateButtons();
      }

      function updateButtons() {
        prevBtn.disabled = (currentPage === 1);
        nextBtn.disabled = (currentPage === totalPages);
      }
      
      nextBtn.addEventListener('click', () => {
        if (currentPage < totalPages) {
          currentPage++;
          showPage(currentPage);
        }
      });

      prevBtn.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          showPage(currentPage);
        }
      });
      
      // ===== START OF THE FINAL PRINT FIX =====
      
      // כפתור ההדפסה רק מפעיל את תהליך ההדפסה
      printBtn.addEventListener('click', () => {
        window.print();
      });

      // אירוע שרץ רגע לפני שהדפדפן פותח את חלון ההדפסה
      window.addEventListener('beforeprint', () => {
        // מציגים את כל העמודים כדי שהמדפסת "תראה" אותם
        pages.forEach(page => {
          page.style.display = 'block';
        });
      });

      // אירוע שרץ אחרי שחלון ההדפסה נסגר (בין אם הדפיסו או ביטלו)
      window.addEventListener('afterprint', () => {
        // מחזירים את התצוגה למצב הרגיל (מציגים רק את העמוד הנוכחי)
        showPage(currentPage);
      });
      
      // ===== END OF THE FINAL PRINT FIX =====

      totalPagesSpan.textContent = totalPages;
      showPage(currentPage);

      // פונקציות העלאת תמונות...
      function setupImageUpload(inputId, previewId) {
        const uploadInput = document.getElementById(inputId);
        const previewElement = document.getElementById(previewId);
        const savedImage = localStorage.getItem(inputId);
        if(savedImage) {
            previewElement.style.backgroundImage = `url(${savedImage})`;
            previewElement.innerHTML = '';
        }
        uploadInput.addEventListener('change', function(event) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
              previewElement.style.backgroundImage = `url(${e.target.result})`;
              previewElement.innerHTML = '';
              try { localStorage.setItem(inputId, e.target.result); }
              catch (error) { alert("התמונה גדולה מדי לשמירה מקומית."); }
            }
            reader.readAsDataURL(file);
          }
        });
      }
      setupImageUpload('profile-upload', 'profile-preview');
      setupImageUpload('friends-upload', 'friends-preview');
      setupImageUpload('class-upload', 'class-preview');
    });
  </script>
</body>
</html>
